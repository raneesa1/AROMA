<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/selectaddress.css" />

    <title>checkout</title>
  </head>
  <body>
    <div style="background-color: black; height: 4px" class="w-100"></div>
    <div id="menuHolder">
      <div
        role="navigation"
        class="sticky-top border-bottom border-top"
        id="mainNavigation"
      >
        <div class="">
          <div class=""></div>
          <div class="m-3" id="siteBrand" style="font-size: 52px">AROMA</div>

          <div class="flex2 text-end d-block d-md-none">
            <button class="whiteLink siteLink">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <!-- 
          <div class="flex2 text-end d-none d-md-block align-content-lg-end">
            <div class="d-flex justify-content-end align-items-center pr-5">
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="17"
                      style="color: black"
                      fill="currentColor"
                      class="bi bi-search"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
                      /></svg></i
                ></a>
              </div>
              <div class="icon-box">
                <a href="profile"
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-person-circle"
                      viewBox="0 0 16 16"
                    >
                      <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                      <path
                        fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
                      /></svg></i
                ></a>
              </div>
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-cart3"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
                      /></svg></i
                ></a>
              </div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
    <div class="d-flex" style="margin-left: 70px">
      <div class="mt-5">
        <h1 class="pb-5">Choose Address and Payment Method</h1>
        Detailed address will help our delivery partner reach your doorstep
        quickly :
      </div>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="318"
          height="122"
          fill="none"
          viewBox="0 0 318 122"
        >
          <path
            fill="#FFE1F1"
            d="M.299 0 124.22 108.361c19.281 16.91 50.576 16.91 69.857 0L318 0H.299Z"
          />
          <mask
            id="mask0_2308_28567"
            width="318"
            height="122"
            x="0"
            y="0"
            maskUnits="userSpaceOnUse"
            style="mask-type: alpha"
          >
            <path
              fill="#FFE1F1"
              d="M.299 0 124.22 108.361c19.281 16.91 50.576 16.91 69.857 0L318 0H.299Z"
            />
          </mask>
          <g mask="url(#mask0_2308_28567)">
            <path
              fill="#000"
              d="M179.738 39.458h-46.701c-2.907 0-5.523 1.457-7.267 3.79L102.904 75.61h108.807l-24.416-32.265c-1.744-2.527-4.554-3.887-7.557-3.887Z"
            />
            <path
              fill="#FFAF86"
              d="M153.578 75.61 137.01 51.51c-1.066-1.555-3.197-1.555-4.263 0l-16.665 24.199v58.311h84.488V75.708h-46.992v-.097Z"
            />
            <path
              fill="#FF8047"
              d="M207.351 39.263c8.883 0 16.084-7.223 16.084-16.133s-7.201-16.133-16.084-16.133-16.083 7.223-16.083 16.133 7.2 16.133 16.083 16.133Z"
            />
            <path
              fill="#fff"
              d="M-17.432 39.069c1.066-1.361 49.414-31.974 97.374-5.443 0 0 18.603-8.358 29.261 5.637l-126.635-.194Z"
            />
            <path
              fill="#F8A2CE"
              d="M249.112 34.598a3.59 3.59 0 0 0 3.585-3.596 3.59 3.59 0 0 0-3.585-3.596 3.59 3.59 0 0 0-3.585 3.596 3.59 3.59 0 0 0 3.585 3.596Z"
            />
            <path
              fill="#fff"
              d="M124.124 19.826a3.59 3.59 0 0 0 3.585-3.596 3.59 3.59 0 0 0-3.585-3.596 3.59 3.59 0 0 0-3.585 3.596 3.59 3.59 0 0 0 3.585 3.596Z"
            />
            <path
              fill="#FFE4D8"
              d="M321.682 45.385c0-3.693 1.551-7.386 4.457-10.107 2.713-2.624 7.073-3.887 10.561-4.082-3.488-.194-7.848-1.652-10.464-4.276-2.907-2.818-4.457-6.414-4.457-10.107 0-.389 0-.486 0 0 0 3.693-1.453 7.386-4.36 10.107-2.713 2.624-6.879 4.18-10.464 4.276 3.488.195 7.654 1.458 10.367 3.985 2.907 2.818 4.36 6.511 4.36 10.204 0 .292 0 .292 0 0Z"
            />
            <path
              fill="#FAC1DE"
              d="M249.112 34.598a3.59 3.59 0 0 0 3.585-3.596 3.59 3.59 0 0 0-3.585-3.596 3.59 3.59 0 0 0-3.585 3.596 3.59 3.59 0 0 0 3.585 3.596Z"
            />
            <path
              fill="#fff"
              d="M145.343 127.701h-22.091V88.147c0-6.123 4.941-11.08 11.045-11.08s11.046 4.957 11.046 11.08V127.7Z"
            />
          </g>
          <path
            fill="#FAC1DE"
            d="M218.592 54.52c.775-.971 36.43-23.615 71.698-4.081 0 0 13.662-6.123 21.606 4.179l-93.304-.097ZM64.44 101.267c0-3.693 1.55-7.386 4.457-10.108 2.713-2.624 7.073-3.887 10.561-4.081-3.488-.195-7.848-1.652-10.464-4.276-2.907-2.819-4.457-6.415-4.457-10.108 0-.388 0-.486 0 0 0 3.693-1.453 7.386-4.36 10.108-2.713 2.624-6.88 4.179-10.464 4.276 3.488.194 7.654 1.457 10.367 3.984 2.907 2.819 4.36 6.512 4.36 10.205 0 .388 0 .388 0 0Z"
          />
          <path
            fill="#FFE5E1"
            d="M240.197 92.423c2.997 0 5.426-2.437 5.426-5.442 0-3.006-2.429-5.443-5.426-5.443-2.996 0-5.426 2.437-5.426 5.443 0 3.005 2.43 5.442 5.426 5.442Z"
          />
          <path
            fill="#FFE4D8"
            d="M20.937 52.188c3.585 0 6.491-2.915 6.491-6.511s-2.906-6.512-6.491-6.512c-3.585 0-6.492 2.916-6.492 6.512 0 3.596 2.907 6.511 6.492 6.511ZM240.197 92.423c2.997 0 5.426-2.437 5.426-5.442 0-3.006-2.429-5.443-5.426-5.443-2.996 0-5.426 2.437-5.426 5.443 0 3.005 2.43 5.442 5.426 5.442Z"
          />
        </svg>
      </div>
    </div>
    <!-- modal -->
    <div
      class="modal fade"
      id="exampleModalCenter"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header" style="background: #000; color: aliceblue">
            <h5
              class="modal-title text-uppercase"
              id="exampleModalLongTitle"
              style="color: aliceblue"
            >
              Add New Address
            </h5>
            <button
              type="button"
              class="close"
              style="color: aliceblue"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addressForm" action="/addnewaddress" method="post">
              <div class="form-group">
                <label for="Addressname">Address Name:</label>
               <select
                      class="form-control"
                      id="exampleSelect1"
                      name="Addressname"
                    >
                      <option>home</option>
                      <option>office</option>
                      <option>Hostel</option>
                      <!-- <option>For Someone else</option> -->
                    </select>

              </div>

              <div class="form-group">
                <label for="Firstname">First Name:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutFirstname"
                  name="Firstname"

                />
                 <small id="checkoutFirstNameError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="Secondname">Second Name:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutSecondname"
                  name="Secondname"

                />
                 <small id="checkoutSecondNameError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="Address">Address:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutAddress"
                  name="Address"

                />
                 <small id="checkoutAddressError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="PhoneNumber">Phone Number:</label>
                <input
                  type="tel"
                  class="form-control"
                  id="checkoutPhonenumber"
                  name="PhoneNumber"

                />
                 <small id="checkoutPhonenumberError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="State">State:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutState"
                  name="State"

                />
                 <small id="checkoutStateError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="Landmark">Landmark(optional) :</label>
                <input
                  type="text"
                  class="form-control"
                  id="Landmark"
                  name="Landmark"
                />

              </div>

              <div class="form-group">
                <label for="City">City:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutCity"
                  name="City"

                />
                 <small id="checkoutCityError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="Pincode">Pincode:</label>
                <input
                  type="text"
                  class="form-control"
                  id="checkoutPincode"
                  name="Pincode"

                />
                 <small id="checkoutPincodeError" class="text-danger"></small>
              </div>

              <div class="form-group">
                <label for="exampleSelect1">Country</label>
                    <select
                      class="form-control"
                      id="exampleSelect1"
                      name="Country"
                    >
                      <option>India</option>
                      <option>Africa</option>
                      <option>America</option>
                      <option>Pakistan</option>
                      <option>China</option>
                      <option>Mexico</option>
                      <option>Italy</option>
                      <option>Spain</option>
                      <option>Russia</option>
                      <option>Argentina</option>
                      <option>Switzerland</option>
                      <option>Singapore</option>
                      <option>Sweden</option>
                      <option>New Zealand</option>
                    </select>
                 <small id="secondNameError" class="text-danger"></small>
              </div>

              <button
                type="submit"
                class="btn"
                style="color: aliceblue; background: #000"
              >
                Save Address
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex">
      <div>
        <form class="ml-5" onsubmit="selectAddress(event)">
          <div class="address">
            <div id="form-checkout" class="w-100 address">
              <div class="address-card addaddress">
                <span
                  class="font3 text-center w-100"
                  data-toggle="modal"
                  data-target="#exampleModalCenter"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="58"
                    height="58"
                    fill="currentColor"
                    class="bi bi-plus-lg"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"
                    />
                  </svg>
                </span>
              </div>

            <% if (defaultaddress && defaultaddress.Address && defaultaddress.Address.length > 0) { %>
  <% defaultaddress.Address.forEach((address, index) => { %>
              <div
                id="address"
                class="address-card addaddress pl-5"
                style="font-size: 17px"
              >
                <!-- <img src="/user/images/add.png" alt="" /> -->

                <span class="font3 w-75">
                  <h3 class="text-lowercase"><%= address.Addressname %></h3>
                  <span class="text-muted">
                    <%= address.Firstname %> <%= address.Secondname %> <%=
                    address.Address %> <%= address.PhoneNumber %> <%=
                    address.State %> <%= address.City %> <%= address.Landmark %>
                    <%= address.Country%> <%= address.Pincode %></span
                  ></span
                >
                <a>
                  <div class="ml-1 mt-4">
                    <input
                      class="form-check-input"
                      value="<%= address._id %>"
                      id="address1"
                      type="radio"
                      name="Address"
                      id="flexRadioDefault<%= address._id %>"
                      checked
                      required
                    />
                    Deliver here

                    <!-- <button class="btn">Deliver here</button> -->
                    <!-- <span style="margin-left: 164px;"> <button class="btn ">Edit</button></span> -->
                  </div>

                  <!-- </button> -->
                </a>
              </div>
                 <% }); %>
 <% } else { %>
</div>
<div></div>

              <!-- <p>No address found for the user.</p> -->
              <% } %>
            </div>
          </div>
          <div class="mb-5 mt-5" style="margin-left: 90px">
            <div class="">Choose the payment method you prefer :</div>
          </div>
          <div class="col-lg-4 mb-3" style="margin-left: 100px">
            <!-- Default checked radio -->
            <div class="form-check border rounded-3">
              <div class="p-3">
               <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked />
                <label class="form-check-label" for="cod">
                  Cash on delivery <br />
                </label>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-3" style="margin-left: 100px">
            <!-- Default radio -->
            <div class="form-check h-100 border rounded-3">
              <div class="p-3">
                 <input class="form-check-input" type="radio" name="paymentMethod" id="online" value="online" />
                <label class="form-check-label" for="online">
                  Razorpay <br />
                </label>
              </div>
            </div>
          </div>
          
           <div class="col-lg-4 mb-3" style="margin-left: 100px">
            <!-- Default radio -->
            <div class="form-check h-100 border rounded-3">
              <div class="p-3">
                 <input class="form-check-input" type="radio" name="paymentMethod" id="wallet" value="wallet" />
                <label class="form-check-label" for="wallet">
                  wallet (balance ₹<%=walletBalance%>) <br />
                </label>
              </div>
            </div>
          </div>
          <!--  -->

      </div>
      
      <div>
        <div
          class="col-xl-12 col-lg- d-flex justify-content-center justify-content-lg-end"
          style="
            margin-top: 60px;
            padding-left: 120px;
            height: 100%;
            border-left: 1px solid rgb(224, 224, 224);
          "
        >
          <div class="ms-lg-4 mt-4 mt-lg-0" style="max-width: 320px">
            <h1 class="mb-3">Summary</h1>
            <div class="d-flex justify-content-between">
              <p class="mb-2">Sub Total :</p>
              <p class="mb-2 text-success">&#8377;<%= subtotal %></p>
            </div>
            <% if(totalProductDiscount > 0){ %>
    <div class="d-flex justify-content-between">
      <p class="mb-2">Discount (product offer):</p>
      <p class="" style="color: green" id="discount">
        - &#8377;<%= totalProductDiscount %>
      </p>
    </div>
  <% } %>
               <% if(!coupon){%>
                      <div class="d-flex justify-content-between ">
                        <p class="mb-2">Discount(coupon):</p>
                        <p  class=""style="color: green" id="discount">-0</p>
                      </div>
                      <% }else{%>

                      <div class="d-flex justify-content-between mb-4">
                        <p class="">Discount(coupon):</p>
                        <p class="" style="color: green" id="discount">
                          - &#8377;<%=coupon%>
                        </p>
                      </div>
                      <% }%>
            <div class="d-flex justify-content-between">
              <p class="mb-2">Tax:</p>
              <p class="mb-2">&#8377;<%= gstAmount %></p>
            </div>
            <div class="d-flex justify-content-between">
              <p class="mb-2">Shipping cost:</p>
              <p class="mb-2 text-danger">&#8377;0</p>
            </div>
            <hr />
            
            <div class="d-flex justify-content-between">
              <p class="mb-2" style="font-weight: bold" ;>Total price:</p>
             
                          <% if (!coupon) { %>
    <p id="TotalPrice" class="mb-2 fw-bold">&#8377;<%= totalWithDiscount %></p>
  <% } else { %>
    <p id="TotalPrice" class="mb-2 fw-bold">&#8377;<%= totalWithDiscount - coupon %></p>
  <% } %>
            </div>
            <hr />
            <h6 class="text-dark my-4">Items in cart</h6>

            <% product.forEach((item,index) => { %>
            <div class="d-flex align-items-center mb-4">
              <div class="me-3 position-relative">
                <span
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill"
                  style="background-color: rgb(226, 224, 224)"
                  ><%= item.quantity %>
                </span>
                <% if (item.productId && item.productId.image &&
                Array.isArray(item.productId.image) &&
                item.productId.image.length > 0) { %>
                <img
                  src="<%= item.productId.image[0]%>"
                  style="height: 96px; width: 96x"
                  class="img-sm rounded border"
                  alt="<%= item.productId.name %>"
                />
                <% } %>
              </div>
              <div class="">
                <a href="#" class="nav-link">
                  <%= item.productId.name %> <br />
                  <span class="text-muted" style="font-size: 12px">
                    <%= item.productId.description %></span
                  >
                </a>
                <div class="price text-muted "  id="productPrice">
                  <% if (item.productId.discountexpiryDate && item.productId.discountexpiryDate > new Date()) { %>
        <!-- Display the discounted price when there is an active offer -->
        <div class="price text-muted ml-3">
          <span>&#8377;<%= item.productId.price - item.productId.discountprice %></span>
          <!-- Display the original price with a strikethrough -->
          <span class="text-danger" style="text-decoration: line-through; font-size: 80%;">
            &#8377;<%= item.productId.price %>
          </span>
        </div>
      <% } else { %>
        <!-- Display the regular price when there is no active offer -->
        <div class="price text-muted ml-3">
          &#8377;<%= item.productId.price %>
        </div>
      <% } %>
                </div>
              </div>
            </div>
            <% }); %>

            <button
              type="submit"
              class="btn btn-dark btn-block btn-lg mb-5 mt-5"
              style="width: 294px; font-size: 20px"
              data-mdb-ripple-color="dark"

            >
              PLACE ORDER
              
              <!-- <svg
                class="mb-1"
                xmlns="http://www.w3.org/2000/svg"
                width="25"
                height="25"
                fill="currentColor"
                class="bi bi-arrow-right"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"
                />
              </svg> -->
            
            </button>
              </form>

            <hr >
         

         <%   if(!coupon){ %>

            <h6 class="mt-4">Enter coupon code</h6>
                      <div class="input-group mt-3 mb-2">
                        <input
                          type="text"
                          class="form-control border"
                          name=""
                          placeholder="Coupon code"
                          id="couponCode"
                        />

                     
                        <button id="applybtn"
                          class="btn btn-light text-dark border " 
                          onclick="applyCoupon()"
                       style="display: block;" >
                          Apply
                        </button>
                          
                      
                              <button 
                          class="btn btn-light text-dark border " 
                          id="cancelCouponBtn" style="display: none;"

                        > 
                        Cancel
                        </button>

                              
                     
                      </div>
                        <p class="ml-5 pl-5 mt-0 pt-0 coupon-text"><a href="">view coupons and save extra!</a></p>
         
              

         <%}else{%>
            <h6 class="mt-4">Enter coupon code</h6>
                      <div class="input-group mt-3 mb-2">
                        <input
                          type="text"
                          class="form-control border"
                          name=""
                          placeholder="Coupon code"
                          id="couponCode"
                        />

                     
                        <button id="applybtn"
                          class="btn btn-light text-dark border " 
                          onclick="applyCoupon()"
                       style="display: none;" >
                          Apply
                        </button>
                          
                      
                              <button 
                          class="btn btn-light text-dark border " 
                          id="cancelCouponBtn" style="display: block;"

                        > 
                        Cancel
                        </button>

                              
                     
                      </div>
                        <p class="ml-5 pl-5 mt-0 pt-0 coupon-text"><a href="">view coupons and save extra!</a></p>
         
              

          

          <%}%>
             
            
                     
                        <hr>
          </div>
        </div>
      </div>
  </div>

</div>
</div>
    <section class="py-5"></section>



<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <!-- <img src="/public/photos/logo_aroma.jpeg" alt=""> -->


    <!-- <script src="https://checkout.razorpay.com/v1/upi.js"></script> -->


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

     <script>




    document.getElementById("addressForm").addEventListener("submit", function (event) {
      function isEmpty(value) {
        const trimmedValue = value.trim();
        return trimmedValue === "";
      }
        function validateAddress(address) {
    const minLength = 40;
    const maxLength = 200; // Change this to your desired maximum length
    const trimmedAddress = address.trim();
    return trimmedAddress.length >= minLength && trimmedAddress.length <= maxLength;
  }

      
      function validateAddress(address) {
        const minLength = 40;
        return address.trim().length >= minLength;
      }

      function validatePhone(phonenumber) {
        const phoneRegex = /^\d{10}$/;
        return phoneRegex.test(phonenumber);
      }

      function validatePinc(pincode) {
        const pinRegex = /^\d{6}$/;
        return pinRegex.test(pincode);
      }


      const checkoutFirstname = document.getElementById("checkoutFirstname");
      const checkoutFirstnameValue = checkoutFirstname.value;
      const checkoutFirstnameError = document.getElementById("checkoutFirstNameError");

      const checkoutSecondname = document.getElementById("checkoutSecondname");
      const checkoutSecondnameValue = checkoutSecondname.value;
      const checkoutSecondnameError = document.getElementById("checkoutSecondNameError");

      const checkoutAddress = document.getElementById("checkoutAddress");
      const checkoutAddressValue = checkoutAddress.value;
      const checkoutAddressError = document.getElementById("checkoutAddressError");

      const checkoutState = document.getElementById("checkoutState");
      const checkoutStateValue = checkoutState.value;
      const checkoutStateError = document.getElementById("checkoutStateError");

      const checkoutCity = document.getElementById("checkoutCity");
      const checkoutCityValue = checkoutCity.value;
      const checkoutCityError = document.getElementById("checkoutCityError");

      const checkoutPincode = document.getElementById("checkoutPincode");
      const checkoutPincodeValue = checkoutPincode.value;
      const checkoutPincodeError = document.getElementById("checkoutPincodeError");

      const checkoutPhonenumber = document.getElementById("checkoutPhonenumber");
      const checkoutPhonenumberValue = checkoutPhonenumber.value;
      const checkoutPhonenumberError = document.getElementById("checkoutPhonenumberError");

      checkoutFirstnameError.textContent = "";
      checkoutSecondnameError.textContent = "";
      checkoutAddressError.textContent = "";
      checkoutStateError.textContent = "";
      checkoutCityError.textContent = "";
      checkoutPincodeError.textContent = "";
      checkoutPhonenumberError.textContent = "";

       if (checkoutFirstnameValue.length > maxFieldLength) {
    checkoutFirstnameError.textContent = "First name is too long";
    event.preventDefault();
  }

  if (checkoutSecondnameValue.length > maxFieldLength) {
    checkoutSecondnameError.textContent = "Second name is too long";
    event.preventDefault();
  }


  if (!validateAddress(checkoutAddressValue)) {
    checkoutAddressError.textContent = "Address should have between 40 and 200 characters";
    event.preventDefault();
  }

      if (isEmpty(checkoutFirstnameValue)) {
        checkoutFirstnameError.textContent = "First name can't be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutSecondnameValue)) {
        checkoutSecondnameError.textContent = "Second name can't be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutAddressValue)) {
        checkoutAddressError.textContent = "Address field can't be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutStateValue)) {
        checkoutStateError.textContent = "State field can't be be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutCityValue)) {
        checkoutCityError.textContent = "City field can't be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutPincodeValue)) {
        checkoutPincodeError.textContent = "Pincode field can't be empty";
        event.preventDefault();
      }

      if (isEmpty(checkoutPhonenumberValue)) {
        checkoutPhonenumberError.textContent = "Phone number field can't be empty";
        event.preventDefault();
      }

      if (!validatePhone(checkoutPhonenumberValue)) {
        checkoutPhonenumberError.textContent = "Phone number must contain 10 characters";
        event.preventDefault();
      }

      if (!validatePinc(checkoutPincodeValue)) {
        checkoutPincodeError.textContent = "Enter a valid pincode";
        event.preventDefault();
      }

      if (!validateAddress(checkoutAddressValue)) {
        checkoutAddressError.textContent = "Address should have at least 40 characters";
        event.preventDefault();
      }
    });
</script>



    <script>
      function showSuccessMessage(message) {
  // Set the success message in the modal
  document.getElementById("successModalMessage").textContent = message;

  // Show the modal
  var successModal = new bootstrap.Modal(
    document.getElementById("successModal")
  );
  successModal.show();
}


     
      function showErrorMessage(message) {
        // Set the error message in the modal
        document.getElementById("errorModalMessage").textContent = message;

        // Show the modal
        var errorModal = new bootstrap.Modal(
          document.getElementById("errorModal")
        );
        errorModal.show();
      }

      

        document.getElementById("closeSuccessModal").addEventListener("click", function () {
  var successModal = new bootstrap.Modal(
    document.getElementById("successModal")
  );
  successModal.hide();
});



      async function selectAddress(event) {
        event.preventDefault();


        // Find the selected address checkbox
        const selectedAddressCheckbox = document.querySelector(
          'input[name="Address"]:checked'
        );
        const selectedPaymentMethod = $("input[name='paymentMethod']:checked").val();

       

        // Check if a checkbox is selected
        if (selectedAddressCheckbox) {
          const selectedAddressId = selectedAddressCheckbox.value;

          if(selectedPaymentMethod === "cod" ||selectedPaymentMethod === "wallet"){
          try {
            const response = await fetch("/topaymentpage", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ selectedAddressId ,selectedPaymentMethod}),
            });
           

            if (response.ok) {
                        console.log("Order successful");
                        window.location.href = "/ordermessage";
            } else {
              console.error("Failed to send selected address");
            }
             const result = await response.json();
          } catch (error) {
            console.error("Error during fetch:", error);
          }
        } else if(selectedPaymentMethod === "online"){

           var paymentId;
            fetch('/generateRazorpayPayment',{
                method:"POST",
                headers:{"content-type":"application/json"},
                body:JSON.stringify({hi:"HIe"})
              
            }).then(response=>response.json()).then(res=>{
                if(res.order){

                    // const orderTotalPaise=orderTotal*100
                    var options = {
                        "key": "rzp_test_sFW0lvsM9VcWEf", 
                        "amount":req.session.TotalPrice * 100,
                        "currency": "INR",
                        "name": "AROMA",
                        "description": "Test Transaction",
                        "order_id": res.order.id, 
                        "handler": function (response) {
                            paymentId=response.razorpay_payment_id
                            // alert(paymentId,"payment idd")
                            if(paymentId){
                              // alert("inside payment id")
                              // alert('just above the veryfy paymentt in razorlay')
                                fetch('/verifyrazorpaypayment',{
                                    method:"post",
                                    headers:{"Content-Type":"application/json"},
                                    body:JSON.stringify({orderId:res.order.id,paymentId})
                                }).then(response=>response.json()).then(res=>{
                                    if(res.status){

                                        window.location.href = "/ordermessage";
                                        fetch('/topaymentpage', {
                                            method: "POST",
                                            headers: {
                                                "Content-Type": "application/json"
                                            },
                                             body: JSON.stringify({ selectedAddressId ,selectedPaymentMethod}),
                                        }).then(response => response.json()).then((res) => {
                                            if (res.status) {

                                                window.location.href = "/ordermessage";
                                                console.log('success')
                                            }
                                        });
                                        
                                        
                                    }else{
                                        alert("Payment failed")
                                    }
                                })
                            }
                           
                        },
                          theme: {
                color: "#000", // Change the color to your preferred theme color
              },
              prefill: {
                name: 'AROMA',
                email: '',
                contact: '',
              },
              notes: {
                address: '',
              },
            
              
                    }
                    var rzp1 = new Razorpay(options);
                    rzp1.on('payment.failed', function (response) {
                        alert("fail")
                        alert(response.error.code);
                        alert(response.error.description);
                        alert(response.error.source);
                        alert(response.error.step);
                        alert(response.error.reason);
                        alert(response.error.metadata.order_id);
                        alert(response.error.metadata.payment_id);
                    });
                    rzp1.open();
                }else{
                    alert(JSON.stringify(res))
                }
            })
        }
      
    }
  }

//===============================================
         function applyCoupon() {
        const couponCode = document.getElementById("couponCode").value;

        fetch("/apply-coupon", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            couponCode: couponCode,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showSuccessMessage("Coupon applied successfully");
              console.log("Coupon applied successfully");
              $("#TotalPrice").text(data.TotalPrice);
              $("#discount").text("- ₹" + data.coupon);
              const apply=document.getElementById('applybtn').style.display='none'
             const cancelOrderBtn=document.getElementById('cancelCouponBtn').style.display='block'
  



            } else {
              showErrorMessage(` ${data.message}`);
              console.error("Coupon application failed:", data.message);
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
            showErrorMessage("An error occurred while applying the coupon");
          });
      }

    </script>
    <script>

  document.getElementById('viewCouponsLink').addEventListener('click', function () {
    $('#couponModal').modal('show');
  });

  
</script>
 <script>
      document.addEventListener("DOMContentLoaded", function () {
        const cancelCouponButton = document.getElementById("cancelCouponBtn");

        if (cancelCouponButton) {
          cancelCouponButton.addEventListener("click", async () => {

             const couponCode = document.getElementById("couponCode").value;


            try {

              const response = await fetch("/cancel-coupon", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ couponCode }),
              });

              const data = await response.json();

              if (data.success) {
                alert("Coupon canceled successfully");
                 $("#discount").text("- ₹" + 0);
                  $("#TotalPrice").text(data.TotalPrice);
                  alert(data)
                  console.log(data)
                  const apply=document.getElementById('applybtn').style.display='block'
                 const cancelOrderBtn=document.getElementById('cancelCouponBtn').style.display='none'
  
                    //  window.location.reload()

                  // alert(data.TotalPrice)
              } else {
                alert(data.message);
              }
            } catch (error) {
              console.error("Error canceling the coupon:", error);
              // Display an error message
              alert("Error canceling the coupon");

            }
          // }
        });
        
        }
      
      });
    
    </script>

     <div class="modal fade" id="errorModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Attention</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="errorModalMessage" class="text-danger"></p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              id="closeErrorModal"
              data-dismiss="modal"
              aria-label="Close"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Coupon Modal -->
<div class="modal fade" id="couponModal" tabindex="-1" role="dialog" aria-labelledby="couponModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="couponModalLabel">Available Coupons</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Example Coupon 1: SAVE10 - 10% off</p>
        <p>Example Coupon 2: FREEDEL - Free delivery</p>
        <!-- Add more coupons as needed -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModalLabel">Success</h5>
          <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
      </div>
      <div class="modal-body">
        <p id="successModalMessage" class="text-success"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"   data-dismiss="modal"
              aria-label="Close">Close</button>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
