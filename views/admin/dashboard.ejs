<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/dashboard.css" />

    <title>dashboard</title>
  </head>
  <body style="background-color: rgb(245, 245, 245)">
    <div style="background-color: black; height: 4px" class="w-100"></div>

    <div id="menuHolder">
      <div
        role="navigation"
        class="sticky-top border-bottom border-top"
        id="mainNavigation"
      >
        <div class="flexMain">
          <div class="flex2"></div>
          <div
            class="flex3"
            id="siteBrand"
            style="font-size: 32px; margin-bottom: 0px; padding-bottom: 0"
          >
            AROMA
          </div>

          <div class="flex2 text-end d-block d-md-none">
            <button class="whiteLink siteLink">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <div class="flex2 text-end d-none d-md-block align-content-lg-end">
            <div class="d-flex justify-content-end align-items-center pr-5">
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="17"
                      style="color: black"
                      fill="currentColor"
                      class="bi bi-search"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
                      /></svg></i
                ></a>
              </div>

              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-person-circle"
                      viewBox="0 0 16 16"
                    >
                      <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                      <path
                        fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
                      /></svg></i
                ></a>
              </div>
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="17"
                      style="color: rgb(0, 0, 0)"
                      fill="currentColor"
                      class="bi bi-heart"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.920 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"
                      /></svg></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex">
      <%- include('./partial/section') %>

      <div class="mt-4 pr-5">
        <div class="d-flex w-100">
          <div
            style="background-color: rgb(255, 255, 255); max-height: 120px"
            class="pr-5 mt-5 ml-5 mr-2"
          >
            <div class="d-flex">
              <div>
                <h5 class="ml-3 mt-3 mb-0" style="color: rgb(75, 73, 73)">
                  Sales
                </h5>
                <p
                  class="ml-3 font-weight-bold mb-0"
                  style="font-size: 24px"
                  id="salesValue"
                >
                  <%-sales%>
                </p>
                <p class="text-muted ml-3 mt-0 pt-0 w-100">Products sold so for</p>
              </div>
              <div>
                <p class="mt-4 ml-5">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="56"
                    height="56"
                    style="
                      color: green;
                      background: lightgreen;
                      padding: 12px;
                      border-radius: 12px;
                    "
                    fill="currentColor"
                    class="bi bi-graph-up-arrow"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"
                    />
                  </svg>
                </p>
              </div>
            </div>
          </div>
          <div
            style="background-color: rgb(255, 255, 255); max-height: 120px"
            class="pr-5 mt-5 ml-5 mr-2 "
          >
            <div class="d-flex">
              <div>
                <h5 class="ml-3 mt-3 mb-0" style="color: rgb(75, 73, 73)">
                  Total Revenue
                </h5>
                <p
                  class="ml-3 font-weight-bold mb-0"
                  style="font-size: 24px"
                  id="revenueValue"
                >
                  â‚¹<%-revenue%>
                </p>
                <p class="text-muted ml-3 mt-0 pt-0 w-100">Total Revenue generated</p>
              </div>
              <div>
                <p class="mt-4 ml-3">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="56"
                    height="56"
                    style="
                      color: rgb(128, 0, 0);
                      background: rgb(238, 144, 144);
                      padding: 12px;
                      border-radius: 12px;
                    "
                    fill="currentColor"
                    class="bi bi-graph-down-arrow"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M0 0h1v15h15v1H0zm10 11.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-1 0v2.6l-3.613-4.417a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61L13.445 11H10.5a.5.5 0 0 0-.5.5"
                    />
                  </svg>
                </p>
              </div>
            </div>
          </div>

          <div
            style="background-color: rgb(255, 255, 255); min-height: 120px"
            class="pr-5 m-5 mr-2 ml-3"
          >
            <div class="d-flex">
              <div>
                <h5 class="ml-3 mt-3 mb-0" style="color: rgb(75, 73, 73)">
                  Customers
                </h5>
                <p
                  class="ml-3 font-weight-bold mb-0"
                  style="font-size: 24px"
                  id="usersValue"
                >
                  <%-users%>
                </p>
                <p class="text-muted ml-3 mt-0 pt-0 w-100">Total Customers</p>
              </div>
              <div>
                <p class="mt-4 ml-5">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="56"
                    height="56"
                    style="
                      color: green;
                      background: lightgreen;
                      padding: 12px;
                      border-radius: 12px;
                    "
                    fill="currentColor"
                    class="bi bi-graph-up-arrow"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"
                    />
                  </svg>
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex">
          <div class="col-div-8 ml-5">
            <div class="box-8">
              <div class="content-box">
                <h3 class="m-1">
                  Top <span style="color: orangered">5</span> Selling Products
                </h3>
                <br />
                <table
                  id="topSellingProductsTableid"
                  class="table-responsive-lg table-light"
                >
                  <% if(topSellingProducts){%>
                  <tr class="pt-5 mt-0">
                    <th>Product Image</th>
                    <th>Product Name</th>
                    <th>Number of orders</th>
                  </tr>

                  <% for (const product of topSellingProducts) { %>
                  <tr>
                    <td>
                      <img
                        src="<%= product.image %>"
                        alt="<%= product.name %>"
                        width="90px"
                        style="max-width: 60px; max-height: 60px"
                      />
                    </td>
                    <td class="h5"><%= product.name %></td>
                    <td class="h6"><%= product.totalOrders %></td>
                  </tr>
                  <% } %> <% } else { %>

                  <tr>
                    <td colspan="3">No top selling products available</td>
                  </tr>
                  <% } %>
                </table>
              </div>
            </div>
          </div>
          <div class="col-div-4">
            <div class="w-50 mb-3">
              <label for="timeRangeDropdown">Filter by days:</label>
              <select id="timeRangeDropdown" class="form-control">
                <option value="7">Last 7 days</option>
                <option value="30">Last 30 days</option>
                <option value="180">Last 180 days</option>
                <option value="365">Last 365 days</option>
              </select>
            </div>
            <div class="box-4">
              <div class="content-box">
                <h4>Total sales</h4>
                <div class="circle-wrap">
                  <div class="circle">
                    <div class="mask full">
                      <div class="fill"></div>
                    </div>
                    <div class="mask full">
                      <div class="fill"></div>
                    </div>
                    <div class="inside-circle">50%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="clearfix"></div>
        </div>
      </div>
    </div>

    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->

    <!-- Bootstrap and JavaScript dependencies -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <script>
      document
        .getElementById("timeRangeDropdown")
        .addEventListener("change", function () {
          // alert("gneognwerog");
          const selectedDays = this.value;
          // alert(selectedDays, "selected days - ");

          // Fetch updated data based on the selected filter
          fetch(`/admin/dashboard?days=${selectedDays}`, {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((response) => response.json())
            .then((data) => {
              // alert(data);
              // console.log(data);
              updateDashboardUI(data);
            })
            .catch((error) => {
              console.error("Error fetching data:", error);
            });
        });

      function updateDashboardUI(data) {


        // Update sales
        const salesElement = document.getElementById("salesValue");
        if (salesElement) {
          salesElement.textContent = data.data.sales;
        }

        // Update revenue
        const revenueElement = document.getElementById("revenueValue");
        if (revenueElement) {
          revenueElement.textContent = `â‚¹${data.data.revenue}`;
        }

        // Update users
        const usersElement = document.getElementById("usersValue");
        if (usersElement) {
          usersElement.textContent = data.data.users;
        }
        console.log(data.data.topSellingProducts);
        // Update top selling products
        const topSellingProductsTable = document.getElementById(
          "topSellingProductsTableid"
        );
        topSellingProductsTable.innerHTML = `<tr>
                    <th>Product Image</th>
                    <th>Product Name</th>
                    <th>Number of orders</th>
                  </tr>`;
        data.data.topSellingProducts.forEach((product) => {
          const row = `
          
                    <tr>
                        <td>
                            <img src="${product.image}" alt="${product.name}" width="90px" style="max-width: 60px; max-height: 60px" />
                        </td>
                        <td class="h5">${product.name}</td>
                        <td class="h6">${product.totalOrders}</td>
                    </tr>
                `;
          topSellingProductsTable.innerHTML += row;
        });
      }
    </script>
  </body>
</html>
