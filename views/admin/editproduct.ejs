<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/editproduct.css" />

    <title>Edit page</title>
  </head>
  <body>
    <div style="background-color: black; height: 4px" class="w-100"></div>

    <div id="menuHolder">
      <div
        role="navigation"
        class="sticky-top border-bottom border-top"
        id="mainNavigation"
      >
        <div class="flexMain">
          <div class="flex2"></div>
          <div
            class="flex3"
            id="siteBrand"
            style="font-size: 52px; margin-bottom: 0px; padding-bottom: 0"
          >
            AROMA
          </div>

          <div class="flex2 text-end d-block d-md-none">
            <button class="whiteLink siteLink">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <div class="flex2 text-end d-none d-md-block align-content-lg-end">
            <div class="d-flex justify-content-end align-items-center pr-5">
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="17"
                      style="color: black"
                      fill="currentColor"
                      class="bi bi-search"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
                      /></svg></i
                ></a>
              </div>

              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-person-circle"
                      viewBox="0 0 16 16"
                    >
                      <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                      <path
                        fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
                      /></svg></i
                ></a>
              </div>
              <div class="icon-box">
                <a href=""
                  ><i
                    ><svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="17"
                      style="color: rgb(0, 0, 0)"
                      fill="currentColor"
                      class="bi bi-heart"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.920 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"
                      /></svg></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="box">
      <div class="row">
        <div class="col-lg-6 mx-auto m-4">
          <div class="card">
            <div
              class="card-header text-center"
              style="background-color: rgb(0, 0, 0); color: aliceblue"
            >
              <h3>EDIT PRODUCT</h3>
            </div>
            <div class="card-body p-4">
              <form
                action="/admin/update/<%=products._id%>"
                method="post"
                id="edited-add-form"
                enctype="multipart/form-data"
              >
                <div class="mb-3">
                  <label for="name">Name</label>
                  <input
                    type="text"
                    name="name"
                    id="edited-name"
                    class="form-control form-control-lg"
                    value="<%=products.name%>"
                  />
                  <small id="edited-nameError" class="text-danger"></small>
                </div>

                <div class="mb-3">
                  <label for="images">Images</label>
                  <div class="existing-images d-flex mb-3">
                    <% products.image.forEach((image, index) => { %>
                    <button
                      type="button"
                      class="btn"
                      onclick="deleteImage('<%-index%>','<%-products._id%>')"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        fill="currentColor"
                        class="bi bi-x"
                        viewBox="0 0 16 16"
                      >
                        <path
                          d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"
                        />
                      </svg>
                    </button>
                    <div class="existing-image">
                      <img
                        src="<%= image %>"
                        alt="Existing Image <%= index + 1 %>"
                        class="img-thumbnail"
                        style="max-width: 100px; max-height: 100px"
                      />

                      <input
                        type="hidden"
                        name="existingImages[]"
                        value="<%= image %>"
                        id="productId"
                      />
                    </div>
                    <% }) %>
                  </div>
                  <input
                    type="file"
                    name="images"
                    id="edited-displayinput"
                    class="form-control-file"
                    multiple
                  />
                  <small id="edited-imagesError" class="text-danger"></small>
                </div>
                <div class="mb-3">
                  <label for="description">Description</label>
                  <textarea
                    name="description"
                    id="edited-desciption"
                    class="form-control form-control-lg"
                  >
<%=products.description%>
</textarea
                  >
                  <small
                    id="edited-desciptionError"
                    class="text-danger"
                  ></small>
                </div>
                <div class="mb-3">
                  <label for="category">Additional Information</label>
                  <textarea
                    type="text"
                    id="edited-additionalinfo"
                    name="specification"
                    class="form-control form-control-lg"
                  >
                  
<%=products.specification%></textarea
                  >
                  <small
                    id="edited-additionalinfoError"
                    class="text-danger"
                  ></small>
                </div>

                <div class="mb-3">
                  <label for="category">Category</label>
                  <select name="category" class="form-control form-control-lg">
                    <% categorydata.forEach((category)=>{ %>
                    <option value="<%-category._id%>">
                      <%-category.name%>
                    </option>
                    <%})%>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="price">Price</label>
                  <input
                    type="number"
                    id="edited-price"
                    name="price"
                    class="form-control form-control-lg"
                    value="<%=products.price%>"
                  />
                  <small id="edited-priceError" class="text-danger"></small>
                </div>
                <div class="mb-3">
                  <label for="price">Stock</label>
                  <input
                    type="number"
                    name="stock"
                    id="edited-stock"
                    class="form-control form-control-lg"
                    value="<%=products.stock%>"
                  />
                  <small id="edited-stockError" class="text-danger"></small>
                </div>

                <hr />

                <input
                  style="
                    background-color: rgb(0, 0, 0);
                    border-color: rgb(0, 0, 0);
                    font-size: 20px;
                    margin-top: 5px;
                  "
                  type="submit"
                  name="submit"
                  value="Edit Product"
                  class="btn btn-primary btn-block"
                />
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script>
      document
        .getElementById("edited-add-form")
        .addEventListener("submit", function (event) {
          function isEmpty(value) {
            const trimmedValue = value.trim();
            return trimmedValue === "";
          }

          const editedName = document.getElementById("edited-name");
          const editedNameValue = editedName.value;
          const editedNameError = document.getElementById("edited-nameError");

          const editedDesciption = document.getElementById("edited-desciption");
          const editedDesciptionValue = editedDesciption.value;
          const editedDesciptionError = document.getElementById(
            "edited-desciptionError"
          );

          const editedAdditionalinfo = document.getElementById(
            "edited-additionalinfo"
          );
          const editedAdditionalinfoValue = editedAdditionalinfo.value;
          const editedAdditionalinfoError = document.getElementById(
            "edited-additionalinfoError"
          );

          const editedPrice = document.getElementById("edited-price");
          const editedPriceValue = parseFloat(editedPrice.value);
          const editedPriceError = document.getElementById("edited-priceError");

          const editedStock = document.getElementById("edited-stock");
          const editedStockValue = parseInt(editedStock.value, 10);
          const editedStockError = document.getElementById("edited-stockError");

          const editedImages = document.getElementById("edited-displayinput");
          const editedImagesError =
            document.getElementById("edited-imagesError");
          const existingImages = document.querySelectorAll(
            "input[name='existingImages[]']"
          );

          editedNameError.textContent = "";
          editedDesciptionError.textContent = "";
          editedAdditionalinfoError.textContent = "";
          editedPriceError.textContent = "";
          editedStockError.textContent = "";
          editedImagesError.textContent = "";

          if (existingImages.length === 0 && editedImages.files.length === 0) {
            editedImagesError.textContent = "Please upload at least one image";
            event.preventDefault();
          }

          if (isEmpty(editedNameValue)) {
            editedNameError.textContent = "Name can't be empty";
            event.preventDefault();
          }

          if (isEmpty(editedDesciptionValue)) {
            editedDesciptionError.textContent = "Description can't be empty";
            event.preventDefault();
          }
          if (isEmpty(editedAdditionalinfoValue)) {
            editedAdditionalinfoError.textContent =
              "Additional information can't be empty";
            event.preventDefault();
          }
          if (isNaN(editedPriceValue) || editedPriceValue <= 0) {
            editedPriceError.textContent = "Price must be a valid number";
            event.preventDefault();
          }

          if (isNaN(editedStockValue) || editedStockValue <= 0) {
            editedStockError.textContent =
              "Stock must be a positive integer greater than 0";
            event.preventDefault();
          }
          if (editedDesciptionValue.length > 45) {
            editedDesciptionError.textContent =
              "Description must not exceed 45 characters";
            event.preventDefault();
          }
          if (editedAdditionalinfoValue.length < 60) {
            editedAdditionalinfoError.textContent =
              "Additional information must be at least 60 characters";
            event.preventDefault();
          }
        });
    </script>

    <script>
      function addVariant() {
        const newVariantsContainer = document.getElementById(
          "newVariantsContainer"
        );
        const newVariant = document.createElement("div");
        newVariant.innerHTML = `
      <div class="mb-3">
        <label for="variantSize">Size/ML</label>
        <select name="variantSize[]" class="form-control form-control-lg">
          <option value="100">100 ML</option>
          <option value="200">200 ML</option>
          <!-- Add more size/ml options as needed -->
        </select>
      </div>
      <div class="mb-3">
        <label for="variantStock">Stock</label>
        <input
          type="number"
          name="existingVariantStock[]"
          class="form-control form-control-lg"
          placeholder="Enter stock for selected size/ml"
          required
        />
      </div>
      <button
        type="button"
        class="remove-variant-btn btn btn-danger"
        onclick="removeVariant(this)"
      >
        Remove Variant
      </button>
    `;
        newVariantsContainer.appendChild(newVariant);
      }

      function removeVariant(button) {
        const container = button.parentElement;
        container.style.display = "none"; // hide the variant

        // If it's an existing variant, add a hidden input to mark it for removal
        const isExistingVariant =
          container.classList.contains("existing-variant");
        if (isExistingVariant) {
          const hiddenInput = document.createElement("input");
          hiddenInput.type = "hidden";
          hiddenInput.name = "variantsToRemove[]";
          hiddenInput.value = container.dataset.variantId; // use a data attribute to store the variant ID
          container.appendChild(hiddenInput);
        }
      }
    </script>
    <script>
      function deleteImage(index, productId) {
        // alert(index);,

        // const productId = document.getElementById("productId").value;
        alert(productId);
        alert(index);
        fetch(`/admin/deleteimage/${productId}/${index}`, {
          method: "DELETE",
        })
          .then((response) => {
            if (response.status === 200) {
              alert("Image deleted successfully");
              window.location.reload();
            } else {
              alert("Failed to delete image");
            }
          })
          .catch((error) => {
            console.error("Error deleting image:", error);
          });
      }
    </script>
  </body>
</html>
